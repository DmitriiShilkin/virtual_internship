<h2 align="center">Виртуальная стажировка</h2>

<h3 align="center">Passage REST API</h3>

<p align="justify">Федерации спортивного туризма России <a href="https://pereval.online">pereval.online</a>
(далее - ФСТР) заказала студентам SkillFactory разработать мобильное приложение для Android и IOS, которое упростило бы
туристам задачу по отправке данных о перевале и сократило время обработки запроса до трёх дней.</p>
<p align="justify">Пользоваться мобильным приложением будут туристы. В горах они будут вносить данные о перевале в
приложение и отправлять их в ФСТР, как только появится доступ в Интернет.</p>
<p align="justify">Модератор из федерации будет верифицировать и вносить в базу данных информацию, полученную от
пользователей, а те в свою очередь смогут увидеть в мобильном приложении статус модерации и просматривать базу с
объектами, внесёнными другими.</p>

<hr>

Турист с помощью мобильного приложения будет передавать в ФСТР следующие данные о перевале:
<ul>
    <li>название объекта;</li>
    <li>что он соединяет;</li>
    <li>информацию о себе:
        <ul>
            <li>адрес электронной почты;</li>
            <li>фамилию;</li>
            <li>имя;</li>
            <li>отчество;</li>
            <li>номер телефона.</li>
        </ul>
    </li>
    <li>координаты объекта и его высоту;</li>
    <li>уровень сложности в зависимости от времени года;</li>
    <li>фотографии.</li>
</ul>

После этого турист нажимает кнопку «Отправить» в мобильном приложении. Мобильное приложение вызовет метод <i>submitData.</i>

Метод:

```
GET /api/submitData/
```

получает и выводит информацию о всех записях (перевалах).

<hr>

Метод:

```
POST /api/submitData/
```

принимает JSON в теле запроса с информацией о перевале. Пример такого JSON:

```
{
    "beauty_title": "пер. ",
    "title": "Пхия",
    "other_titles": "Триев",
    "connect": "", //что соединяет, текстовое поле
    "add_time": "2021-09-22 13:18:13",
     
    "user": {
        "email": "qwerty@mail.ru", 		
        "fam": "Пупкин",
        "name": "Василий",
        "otc": "Иванович",
        "phone": "+7 555 55 55"
    }, 
      
    "coords": {
        "latitude": "45.3842",
        "longitude": "7.1525",
        "height": "1200"
    },
      
    "level": {
        "winter": "", //Категория трудности. В разное время года перевал может иметь разную категорию трудности
        "summer": "1a",
        "autumn": "1a",
        "spring": ""
    },
      
    images: [
        {
            data:"<картинка1>",
            title:"Седловина"
        },
        {
            data:"<картинка>",
            title:"Подъём"
        }
    ]
}
```

Результат метода: JSON
<ul>
    <li><b>status</b> — код HTTP, целое число:</li>
    <ul>
        <li>200 — успех;</li>
        <li>400 — Bad Request (при нехватке полей);</li>
        <li>500 — ошибка при выполнении операции.</li>
    </ul>
    <li><b>message</b> — строка:</li>
    <ul>
        <li>причина ошибки (если она была);</li>
        <li>отправлено успешно;</li>
        <li>если отправка успешна, дополнительно возвращается id вставленной записи.</li>
    </ul>
    <li><b>id</b> — идентификатор, который был присвоен объекту при добавлении в базу данных.</li>
</ul>
   
Примеры oтветов:

```
{ "status": 200, "message": "Успех, "id": 5 }`
{ "status": 500, "message": "Ошибка при выполнении операции","id": null}
```

<p align="justify">После того, как турист добавит в базу данных информацию о новом перевале, сотрудники ФСТР проведут
модерацию для каждого нового объекта и поменяют поле status.</p>

Допустимые значения поля status:
<ul>
     <li><b>new</b>;</li>
     <li><b>pending</b> — модератор взял в работу;</li>
     <li><b>accepted</b> — модерация прошла успешно;</li>
     <li><b>rejected</b> — модерация прошла, информация не принята.</li>     
</ul>

<hr>

Метод:

```
GET /api/submitData/<id>/
```

получает одну запись (перевал) по её id с выводом всей информации о перевале, в том числе статус модерации.

<hr>

Метод:

```
PATCH /api/submitData/<id>/
```

<p align="justify">позволяет отредактировать существующую запись (замена), при условии, что она в статусе "new". При
этом редактировать можно все поля, кроме тех, что содержат ФИО, адрес почты и номер телефона. В качестве результата
изменения приходит ответ содержащий следующие данные:</p>
<ul>
     <li><b>state</b>:</li>
          <ul>
               <li>1 — если успешно удалось отредактировать запись в базе данных;</li>
               <li>0 — если отредактировать запись не удалось.</li>
          </ul>
     <li><b>message</b>: сообщение о причине неудачного обновления записи.</li>
</ul>

<hr>

Метод:

```
GET /api/submitData/?user_id__email=<email>
```

<p align="justify">позволяет получить данные всех объектов, отправленных на сервер пользователем с почтой. В качестве
реализации использована фильтрация по адресу электронной почты пользователя с помощью пакета <b>django-filter</b>.</p>

<hr>

Дополнительно:
<ol>
     <li>Реализовано повторное использование существующего объекта модели <b>User</b> при создании нового объекта модели
          <b>Passage</b>. Если запрос (метод <b>POST api/submitData/</b>) на добавление записи отправляет пользователь,
          ранее отправлявший такой запрос (определяется по <b>email</b>), то для текущей записи используются ранее
          записанные данные пользователя, а не создается новый пользователь (объект модели <b>User</b>).
     </li>
     <li>Для создания и изменения объектов моделей со связанными данными вложенных сериализаторов использован пакет
     <b>drf-writable-nested</b>.
     </li>
</ol>

<hr>

Проект опубликован на хостинге pythonanywhere.com:

<a href="https://dmitriishilkin.pythonanywhere.com/api/submitData/">Passage REST API</a>

<a href="https://dmitriishilkin.pythonanywhere.com/swagger-ui/">Документация Swagger</a>

<hr>

<p><b>Отчет о выполнении тестов</b>:<br>

Found 7 test(s).<br>
Creating test database for alias 'default'...<br>
System check identified no issues (0 silenced).<br>
False<br>
....False<br>
.True<br>
.True<br>
.<br>
----------------------------------------------------------------------<br>
Ran 7 tests in 0.106s<br>
<br>
OK<br>
Destroying test database for alias 'default'...</p>
